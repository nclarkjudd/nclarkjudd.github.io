<!DOCTYPE html>
<html lang="en">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title> Notes on an Emacs workflow for academic documents - Nick Judd </title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="/theme/css/poole.css" />
		<link rel="stylesheet" href="/theme/css/hyde.css" />
		<link rel="stylesheet" href="/theme/css/syntax.css" />
		<link rel="stylesheet" href="/theme/font-awesome/css/font-awesome.min.css">

		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
	</head>

	<body class="theme-base-0d">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="/images/njudd.jpg">
					Nick Judd
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead"> </p>
			<p></p>
		</div>
		<nav class="sidebar-nav">
		  <a href="/">Home</a> | <a href="/files/ncj-cv.pdf">CV</a> | <a href="/blog/">Blog</a> | <a href="/software.html">Software</a> |
		</nav>
		<nav class="sidebar-nav">
			<a class="sidebar-nav-item" href="mailto:nick@nclarkjudd.com">
				<i class="fa fa-envelope"></i>
			</a>
			<a class="sidebar-nav-item" href="http://www.github.com/nclarkjudd">
				<i class="fa fa-github"></i>
			</a>
			<a class="sidebar-nav-item" href="http://www.twitter.com/nclarkjudd">
				<i class="fa fa-twitter"></i>
			</a>
			<a class="sidebar-nav-item" href="http://www.linkedin.com/in/nclarkjudd">
				<i class="fa fa-linkedin"></i>
			</a>
			<a class="sidebar-nav-item" href="">
				<i class="fa fa-feed"></i>
			</a>
		</nav>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">Notes on an Emacs workflow for academic documents</h1>
	<span class="post-date">Sat 13 February 2016</span>
	<p>I've put together a workflow for authoring in raw text using Emacs. These are my notes:</p>
<h2>1. Why author in emacs?</h2>
<p>The sociologist Kieran Healy argues that Emacs is a very useful tool if you want to <a href="http://kieranhealy.org/blog/archives/2014/01/23/plain-text/">present research results</a> in a professional, clear, and well-organized manner. Frankly, to get to the point where this is true, one must climb a steep learning curve. I think the productivity gains make it worth the effort.</p>
<p>I do a lot of document preparation in <a href="https://daringfireball.net/projects/markdown/">Markdown</a>. I can move documents from Markdown to <a href="https://latex-project.org/intro.html">LaTeX</a>, a sophisticated document preparation system favored by many academics, using <a href="http://pandoc.org">Pandoc</a>. There is a <a href="https://joostkremers.github.io/pandoc-mode/">"Pandoc mode"</a> available for Emacs. Importantly, I can add LaTeX preamble commands to a YAML snippet at the top of each document, like so:</p>
<div class="highlight"><pre><span></span>---
title: &#39;An Example Title.&#39;
author: &quot;Nick Judd&quot;
abstract: &quot;Paper abstract.&quot;
date: &quot;February 15, 2016&quot;
classoption: titlepage
header-includes:
- \usepackage{txfonts}
and so on ...

---
</pre></div>


<p>I can also add math which will be immediately typeset the "right way." This is one of the biggest perks to using something that is built on top of TeX. For instance, I can write <code>$a^2 + b^2 = c^2$</code> and it will be converted from Markdown into LaTeX the same way it is converted using Mathjax on this site: <span class="math">\(a^2 + b^2 = c^2\)</span>.</p>
<h3>Bibliographies and citations</h3>
<p>Academic work involves fastidious recordkeeping about external sources. I prefer Zotero because it has two key features:</p>
<ol>
<li>
<p>Firefox integration that downloads a journal article citation, the PDF (where available), and relevant metadata with one click, meaning it is very easy to get data <em>in</em>;</p>
</li>
<li>
<p>It has many options for generating citations in different formats and for exporting entire bibliographies -- it is easy to get data <em>out</em>, for research purposes and to make sure no software can hold my work hostage.</p>
</li>
</ol>
<p>Several packages integrate Zotero with Pandoc and Emacs. The one that works for me is <a href="https://gitlab.com/egh/zotxt">zotxt</a>. I use Zotxt to satisfy another set of criteria:</p>
<ol>
<li>
<p>On-the-fly bibliography management;</p>
</li>
<li>
<p>On-the-fly citations --- I don't want to do any cut-pasting or hunting around for the right citation key to use;</p>
</li>
<li>
<p>Relative ease of use.</p>
</li>
</ol>
<h3>Professional results</h3>
<p>Tools like <code>ggplot2</code> and <code>stargazer</code> in R or <code>pandas</code>, <code>seaborn</code>, and <code>statsmodels</code> in Python generate beautiful tables and charts. They can also be used to generate raw LaTeX output suitable for integrating directly into a document.</p>
<p>With many tables and figures in each document, this sort of thing is easy to do and quick to replicate in Markdown and LaTeX, but would start to get tedious in Word.</p>
<h2>2. How-to</h2>
<h3>Installation</h3>
<p>I'll assume you have figured out how to download and install the following:</p>
<ul>
<li>LaTeX/Texlive/BibLaTeX</li>
<li>Python (should be on your computer already) and <code>pip</code> (instructions <a href="https://pypi.python.org/pypi/pip">here</a>).</li>
<li>Zotero Standalone (I use the Firefox extension to acquire PDFs, but got the citation workflow going using Standalone.)</li>
<li>Pandoc and pandoc-citeproc</li>
<li>Emacs</li>
<li>pandoc-mode</li>
<li><a href="https://gitlab.com/egh/zotxt/">pandoc-zotxt</a></li>
</ul>
<p>For some reason my Emacs and Pandoc did not come with citeproc. In Fedora, I installed it using the dnf package manager like this: <code>sudo dnf install pandoc-citeproc.x86_64</code>. You might consider <a href="https://github.com/kjhealy/emacs-starter-kit">Kieran Healy's Emacs Starter Kit</a> if acquiring everything seems mystifying. (Zotero should be pretty straightforward to get separately.)</p>
<p>Now, the part that is especially non-obvious:</p>
<ol>
<li>Go to zotxt's <a href="https://addons.mozilla.org/en-US/firefox/addon/zotxt/">Firefox Add-ons page</a>; right-click on "Add to Firefox;" save the file.</li>
<li>With Zotero Standalone open, go to <code>Tools -&gt; Add-ons</code> and select "Install Add-on From File." I found this option by clicking on the crossed hammer and screwdriver at upper right; perhaps your interface is a little different. In the dialog box, select the file you just downloaded.</li>
<li>Again in Zotero Standalone, go to <code>Preferences -&gt; Export</code> and change the "Default Output Format" for QuickCopy to "Easy Citekey." If that option doesn't exist, restart Zotero Standalone and try again; it might need to be restarted for it to pick up on the fact that zotxt is there now.</li>
</ol>
<p>The Easy Citekey format is Pandoc-friendly --- you'll see how it works a little later.</p>
<p>Now you should have all of the tools you need.</p>
<h3>The Workflow</h3>
<ol>
<li>Try out the Emacs interactive tutorial if you haven't used Emacs before. The tutorial is comprehensive, assumes no prior knowledge, and is very user-friendly.</li>
<li>Author your work in an Emacs file in Markdown. With Emacs open, you can open a new file by holding down Control and pressing x, then holding down Control and pressing f. Emacs users call these "chords" and would abbreviate that combo like this: <code>C-x C-f</code>. Notice an open "minibuffer" at the bottom of the Emacs screen; you can use this to specify out  The link again to the basic syntax is <a href="https://daringfireball.net/projects/markdown/">here</a>. How to use YAML metadata blocks for Pandoc is <a href="http://pandoc.org/README.html#extension-yaml_metadata_block">here</a>.</li>
<li><strong>Adding a citation</strong>: With Zotero Standalone open and while working in Emacs, place your cursor where you want the citation to go and use this keychord: <code>C-c " k</code> (Control-c, then shift-single-quote for double quotes, then the letter k).</li>
<li>Notice the minibuffer at the bottom of the screen is now active; it wants you to hit <code>Enter</code>, so do that.</li>
<li>In the next prompt in the minibuffer, type the author's last name and the date of the citation you want and hit <code>Enter</code>.</li>
<li>Use the up and down arrow keys to navigate to the correct citation and hit <code>Enter</code> when you've found it. You should now see a citekey in your document beginning with the "@" symbol. For Pandoc to make use of this, the ref must be in brackets ([]). You can additionally add multiple citations by separating them with semicolons (;) so the whole package looks like this: <code>[@mayhew:1974;@fenno:1978]</code>.</li>
<li>Generating a document: After saving the Markdown file, open up a terminal, console, or shell window. Navigate to the appropriate directory and run Pandoc from the command line, invoking both zotxt and citeproc like this: <code>pandoc -F pandoc-zotxt -F pandoc-citeproc -s inputfile.md -o outputfile.pdf</code>.</li>
<li>Notice that the bibliography has been inserted at the end of the document by default. You could also output LaTeX and edit that file to customize where your bibliography goes.</li>
</ol>
<h3>Troubleshooting and Customization</h3>
<p>Sometimes citeproc won't pick up on a reference because it is a duplicate. You can fix this by specifying a citekey of your own within Zotero. If a reference isn't showing up, open up Zotero and add a citekey as a tag. See the section "Creating a custom citekey" <a href="https://gitlab.com/egh/zotxt">here</a>.</p>
<p>The syntax for invoking zotxt from Pandoc is adapted from <a href="https://whk.name/cookbook/zoteroPandoc/">Warren Knight's recipe</a>.</p>
<h2>Improve This Workflow</h2>
<p>I'd love to hear about other productivity hacks that beat this procedure for speed or ease of use.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
</div>
		</div>
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12927045-2', 'auto');
  ga('send', 'pageview');

</script>
	</body>
</html>